<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>태풍 6시간 뒤 풍속 예측</title>

  <!-- 글꼴 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- 모델 규칙 JS -->
  <script src="./models/decision_tree_rules.js"></script>

  <style>
    :root{
      --bg1:#0f172a;
      --bg2:#1e293b;
      --card:#0b1226cc;
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --ok:#10b981;
      --danger:#ef4444;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0; padding:32px;
      font-family:"Pretendard",system-ui;
      background:
        radial-gradient(1000px 700px at 20% 10%, rgba(103,232,249,.25), transparent 60%),
        radial-gradient(800px 600px at 80% 120%, rgba(167,139,250,.25), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      color:var(--text);
      display:flex; justify-content:center; align-items:center;
      min-height:100vh;
    }
    .wrap{width:min(960px,100%);animation:fadeIn .7s ease both;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
    .title{display:flex;align-items:center;gap:14px;margin-bottom:10px;}
    .logo{
      width:42px;height:42px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:var(--shadow);display:grid;place-items:center;
      font-weight:800;color:#0b1226;
    }
    h1{margin:0;font-size:clamp(1.3rem,2.4vw,2rem);}
    .subtitle{color:var(--muted);margin:6px 0 18px;font-size:.96rem;}
    .card{
      background:var(--card);backdrop-filter:blur(12px);
      border:1px solid rgba(148,163,184,.25);
      border-radius:var(--radius);padding:22px;
      box-shadow:var(--shadow);
    }
    .grid{display:grid;gap:14px;}
    @media(min-width:720px){.grid{grid-template-columns:repeat(2,1fr);}}
    .field{display:flex;flex-direction:column;gap:8px;background:rgba(2,6,23,.35);
      border:1px solid rgba(148,163,184,.25);padding:12px;border-radius:12px;}
    label{font-weight:600;font-size:.95rem;}
    input,select{
      padding:12px;border:1px solid rgba(148,163,184,.2);
      border-radius:10px;background:rgba(15,23,42,.6);
      color:var(--text);font-size:16px;outline:none;
    }
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(110,231,255,.15);}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;}
    button{
      border:0;border-radius:12px;padding:12px 16px;cursor:pointer;
      font-weight:700;transition:.15s ease all;
    }
    #predict{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b1226;box-shadow:0 12px 30px rgba(110,231,255,.25);}
    #predict:hover{transform:translateY(-1px);}
    #clear{background:rgba(148,163,184,.18);color:var(--text);border:1px solid rgba(148,163,184,.25);}
    #example{background:rgba(167,139,250,.2);color:var(--text);border:1px solid rgba(167,139,250,.3);}
    .ranges{margin:14px 4px 0;color:var(--muted);font-size:.92rem;}
    .result{margin-top:18px;font-size:1.05rem;font-weight:700;
      padding:14px 16px;border-radius:12px;background:rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.25);}
    .result.ok{color:var(--ok);border-color:rgba(16,185,129,.35);}
    .result.err{color:var(--danger);border-color:rgba(239,68,68,.35);}
    .grade{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;font-weight:700;font-size:.92rem;
      border:1px solid rgba(148,163,184,.25);background:rgba(2,6,23,.45);
    }
    .dot{width:10px;height:10px;border-radius:999px;background:#999;}
    footer{margin-top:16px;color:var(--muted);font-size:.88rem;text-align:center;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <div class="logo">🌀</div>
      <h1>태풍 6시간 뒤 풍속 예측</h1>
    </div>
    <div class="subtitle">현재 상태 4가지를 입력하면, 브라우저에서 즉시 예측합니다. (결정트리 모델)</div>

    <div class="card">
      <div class="grid">
        <div class="field">
          <label for="wind">현재 최대풍속</label>
          <div style="display:flex;gap:8px;">
            <input id="wind" type="number" step="0.1" placeholder="예: 50" inputmode="decimal" style="flex:1;">
            <select id="windUnit" aria-label="wind unit">
              <option value="kt" selected>kt</option>
              <option value="mps">m/s</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="pressure">중심기압 (hPa)</label>
          <input id="pressure" type="number" step="0.1" placeholder="예: 970" inputmode="decimal">
        </div>
        <div class="field">
          <label for="lat">위도 (°N)</label>
          <input id="lat" type="number" step="0.01" placeholder="예: 25.2" inputmode="decimal">
        </div>
        <div class="field">
          <label for="lon">경도 (°E)</label>
          <input id="lon" type="number" step="0.01" placeholder="예: 126.3" inputmode="decimal">
        </div>
      </div>

      <div class="actions">
        <button id="predict">예측하기</button>
        <button id="clear">지우기</button>
        <button id="example">예시 자동입력</button>
      </div>

      <div class="ranges">권장 범위 · 풍속 0–120 kt · 기압 880–1040 hPa · 위도 0–60N · 경도 100–160E</div>
      <div class="result" id="result">입력 후 “예측하기”를 눌러주세요.</div>
      <div id="grade" class="grade"></div>
    </div>

    <footer>모델: DecisionTreeRegressor · 단위 변환: kt ↔ m/s · 브라우저에서 오프라인 예측</footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const RANGES = {
      wind:{min:0,max:120}, pressure:{min:880,max:1040}, lat:{min:0,max:60}, lon:{min:100,max:160}
    };
    const inRange=(v,{min,max})=> v>=min && v<=max;

    // 풍속(m/s)에 따른 등급
    function gradeWind(y_mps){
      if (y_mps < 17.2) return {label:"약함(열대저기압)",color:"#60a5fa",desc:"강수·돌풍 가능성 있으나 피해 적음"};
      if (y_mps < 24.5) return {label:"보통(열대폭풍)",color:"#34d399",desc:"해상·야외활동 주의"};
      if (y_mps < 32.7) return {label:"강함(강한 열대폭풍)",color:"#f59e0b",desc:"강풍·호우 대비 필요"};
      return {label:"매우 강함(태풍)",color:"#ef4444",desc:"광범위한 피해 가능성, 철저 대비 필요"};
    }

    function getInputs(){
      return {
        windVal: parseFloat($("wind").value),
        windUnit: $("windUnit").value,
        pressure: parseFloat($("pressure").value),
        lat: parseFloat($("lat").value),
        lon: parseFloat($("lon").value),
      };
    }

    function validate({windVal, windUnit, pressure, lat, lon}){
      if ([windVal, pressure, lat, lon].some(v => Number.isNaN(v)))
        return "모든 입력을 숫자로 채워주세요.";
      const windKt = (windUnit === "mps") ? (windVal / 0.514) : windVal;
      if (!inRange(windKt, RANGES.wind)) return `풍속(kt)은 ${RANGES.wind.min}~${RANGES.wind.max} 범위로 입력해주세요.`;
      if (!inRange(pressure, RANGES.pressure)) return `기압(hPa)은 ${RANGES.pressure.min}~${RANGES.pressure.max} 범위로 입력해주세요.`;
      if (!inRange(lat, RANGES.lat)) return `위도(°N)는 ${RANGES.lat.min}~${RANGES.lat.max} 범위로 입력해주세요.`;
      if (!inRange(lon, RANGES.lon)) return `경도(°E)는 ${RANGES.lon.min}~${RANGES.lon.max} 범위로 입력해주세요.`;
      return null;
    }

    function predict(){
      const res = $("result");
      const box = $("grade");
      const inputs = getInputs();
      const err = validate(inputs);
      if (err){ res.textContent = err; res.className = "result err"; box.innerHTML=""; return; }
      const windKt = (inputs.windUnit === "mps") ? (inputs.windVal / 0.514) : inputs.windVal;

      try{
        const y_mps = predictNextWindMps(windKt, inputs.pressure, inputs.lat, inputs.lon);
        const y_kt  = y_mps / 0.514;
        res.innerHTML = `6시간 뒤 예측 풍속: <b>${y_mps.toFixed(2)} m/s</b> (≈ ${y_kt.toFixed(1)} kt)`;
        res.className = "result ok";

        const g = gradeWind(y_mps);
        box.innerHTML = `
          <span class="chip"><span class="dot" style="background:${g.color}"></span>${g.label}</span>
          <span class="chip" style="opacity:.9">${g.desc}</span>`;
      }catch(e){
        res.textContent = "예측 중 오류가 발생했습니다."; res.className="result err"; box.innerHTML="";
      }
    }

    function clearAll(){
      ["wind","pressure","lat","lon"].forEach(id=>$(id).value="");
      $("windUnit").value="kt";
      $("result").textContent="입력 후 “예측하기”를 눌러주세요.";
      $("result").className="result";
      $("grade").innerHTML="";
    }

    // 자동 예시 입력
    function fillExample(){
      $("wind").value = 50;
      $("windUnit").value = "kt";
      $("pressure").value = 970;
      $("lat").value = 25.2;
      $("lon").value = 126.3;
    }

    $("predict").addEventListener("click", predict);
    $("clear").addEventListener("click", clearAll);
    $("example").addEventListener("click", fillExample);
    ["wind","pressure","lat","lon"].forEach(id=>{
      $(id).addEventListener("keydown", e=>{ if(e.key==="Enter") predict(); });
    });
  </script>
</body>
</html>
